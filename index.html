<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransBridge - 多模型翻译网关</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .bg-gradient {
            background: linear-gradient(135deg, #4f46e5 0%, #7dd3fc 100%);
        }
        .demo-container {
            min-height: 400px;
        }
        .fade-in {
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        .translation-panel {
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .textarea-container {
            height: 180px;
            position: relative;
        }
        .textarea-container textarea {
            height: 100%;
            resize: none;
            overflow-y: auto;
            padding-bottom: 40px;
        }
        .character-count {
            position: absolute;
            bottom: 8px;
            right: 12px;
            font-size: 12px;
            color: #6b7280;
        }
        .swap-btn {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
<!-- 导航栏 -->
<nav class="bg-white shadow-md">
    <div class="container mx-auto px-6 py-3 flex justify-between items-center">
        <div class="flex items-center">
            <span class="text-2xl font-bold text-indigo-600">TransBridge</span>
            <span class="ml-2 text-sm bg-indigo-100 text-indigo-800 py-1 px-2 rounded">翻译网关</span>
        </div>
        <div class="flex items-center space-x-4">
            <a href="https://github.com/fruitbars/transbridge" class="text-gray-700 hover:text-indigo-600" target="_blank">
                <i class="fab fa-github text-xl"></i>
            </a>
            <a href="https://github.com/fruitbars/transbridge#readme" class="hidden md:block text-gray-700 hover:text-indigo-600" target="_blank">文档</a>
            <a href="#demo" class="hidden md:block text-gray-700 hover:text-indigo-600">在线演示</a>
            <a href="#features" class="hidden md:block text-gray-700 hover:text-indigo-600">特性</a>
        </div>
    </div>
</nav>

<!-- Hero 部分 (简短版) -->
<header class="bg-gradient text-white py-10">
    <div class="container mx-auto px-6 text-center">
        <h1 class="text-3xl md:text-4xl font-bold mb-3">TransBridge 翻译网关</h1>
        <p class="text-lg md:text-xl mb-5">基于多种 AI 模型的高性能翻译服务</p>
    </div>
</header>

<!-- 谷歌风格翻译界面 -->
<section id="demo" class="py-10 bg-white">
    <div class="container mx-auto px-6">
        <h2 class="text-2xl md:text-3xl font-bold text-center mb-8">在线体验</h2>

        <!-- 语言选择区域 -->
        <div class="max-w-5xl mx-auto bg-white rounded-t-lg border border-gray-200 border-b-0 p-4">
            <div class="flex flex-wrap justify-center items-center">
                <div class="mr-2 mb-2">
                    <select id="source-lang" class="p-2 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white">
                        <option value="EN">英语</option>
                        <option value="ZH">中文</option>
                        <option value="JA">日语</option>
                        <option value="KO">韩语</option>
                        <option value="FR">法语</option>
                        <option value="DE">德语</option>
                        <option value="ES">西班牙语</option>
                        <option value="IT">意大利语</option>
                        <option value="RU">俄语</option>
                    </select>
                </div>

                <!-- 交换语言按钮 -->
                <button id="swap-lang-btn" class="mx-2 mb-2 bg-white border border-gray-200 rounded-full w-10 h-10 flex items-center justify-center hover:bg-gray-50 focus:outline-none">
                    <i class="fas fa-exchange-alt text-indigo-600"></i>
                </button>

                <div class="ml-2 mb-2">
                    <select id="target-lang" class="p-2 border rounded focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white">
                        <option value="ZH">中文</option>
                        <option value="EN">英语</option>
                        <option value="JA">日语</option>
                        <option value="KO">韩语</option>
                        <option value="FR">法语</option>
                        <option value="DE">德语</option>
                        <option value="ES">西班牙语</option>
                        <option value="IT">意大利语</option>
                        <option value="RU">俄语</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- 翻译面板 -->
        <div class="max-w-5xl mx-auto translation-panel bg-white rounded-b-lg border border-gray-200 demo-container">
            <div class="flex flex-col md:flex-row">
                <!-- 左侧：原文输入 -->
                <div class="w-full md:w-1/2 p-4 border-b md:border-b-0 md:border-r border-gray-200 textarea-container">
                    <textarea id="source-text" class="w-full h-full p-3 border-none focus:outline-none focus:ring-0" placeholder="请输入要翻译的文本..."></textarea>
                    <div id="source-count" class="character-count">0/5000</div>

                    <!-- 原文功能按钮 -->
                    <div class="absolute bottom-2 left-4 flex space-x-2">
                        <button id="clear-source-btn" class="text-gray-500 hover:text-gray-700 p-1" title="清空文本">
                            <i class="fas fa-times-circle"></i>
                        </button>
                        <button id="speak-source-btn" class="text-gray-500 hover:text-gray-700 p-1" title="朗读文本">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <button id="copy-source-btn" class="text-gray-500 hover:text-gray-700 p-1" title="复制文本">
                            <i class="far fa-copy"></i>
                        </button>
                    </div>
                </div>

                <!-- 右侧：译文显示 -->
                <div class="w-full md:w-1/2 p-4 textarea-container bg-gray-50">
                    <div id="translated-text" class="w-full h-full p-3 overflow-y-auto"></div>

                    <!-- 译文功能按钮 -->
                    <div class="absolute bottom-2 left-4 flex space-x-2">
                        <button id="speak-translated-btn" class="text-gray-500 hover:text-gray-700 p-1" title="朗读译文">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <button id="copy-translated-btn" class="text-gray-500 hover:text-gray-700 p-1" title="复制译文">
                            <i class="far fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 翻译按钮区域 -->
            <div class="border-t border-gray-200 p-4 flex justify-between items-center">
                <div id="status-message" class="text-gray-500 text-sm"></div>
                <button id="translate-btn" class="bg-indigo-600 text-white font-medium py-2 px-6 rounded hover:bg-indigo-700 transition duration-200 flex items-center">
                    <i class="fas fa-language mr-2"></i>翻译
                </button>
            </div>

            <!-- 错误信息 -->
            <div id="error-container" class="p-4 hidden">
                <div id="error-message" class="p-3 bg-red-50 text-red-600 border border-red-200 rounded fade-in"></div>
            </div>

            <!-- 加载指示器 -->
            <div id="loading" class="absolute inset-0 bg-white bg-opacity-80 flex items-center justify-center hidden">
                <div class="flex flex-col items-center">
                    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"></div>
                    <p class="mt-2 text-gray-600">正在翻译...</p>
                </div>
            </div>
        </div>

        <div class="text-center mt-6">
            <p class="text-gray-600">API 服务: <a href="https://freeapi.fanyimao.cn/" class="text-indigo-600 hover:underline">https://freeapi.fanyimao.cn/</a></p>
        </div>
    </div>
</section>

<!-- 其余部分保持不变 -->
<!-- 特性部分 -->
<section id="features" class="py-16 bg-gray-50">
    <div class="container mx-auto px-6">
        <h2 class="text-3xl font-bold text-center mb-12">主要特性</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="bg-white p-6 rounded-lg shadow-sm hover:shadow-md transition duration-200">
                <div class="text-indigo-600 text-4xl mb-4">
                    <i class="fas fa-layer-group"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">多模型支持</h3>
                <p class="text-gray-600">支持多种 AI 翻译模型，如 OpenAI、ChatGLM、DeepSeek 等，基于权重的模型选择策略。</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-sm hover:shadow-md transition duration-200">
                <div class="text-indigo-600 text-4xl mb-4">
                    <i class="fas fa-database"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">多级缓存</h3>
                <p class="text-gray-600">支持内存缓存和 Redis 缓存，灵活配置缓存策略，提高翻译效率。</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-sm hover:shadow-md transition duration-200">
                <div class="text-indigo-600 text-4xl mb-4">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">API 兼容</h3>
                <p class="text-gray-600">兼容 DeepL API 接口格式，支持 OpenAI 兼容接口，便于应用迁移。</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-sm hover:shadow-md transition duration-200">
                <div class="text-indigo-600 text-4xl mb-4">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">安全认证</h3>
                <p class="text-gray-600">支持 API 密钥认证机制，保护您的 API 不被未授权访问。</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-sm hover:shadow-md transition duration-200">
                <div class="text-indigo-600 text-4xl mb-4">
                    <i class="fas fa-file-alt"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">日志记录</h3>
                <p class="text-gray-600">异步日志系统，支持自动轮转和长期存储，便于追踪和分析。</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-sm hover:shadow-md transition duration-200">
                <div class="text-indigo-600 text-4xl mb-4">
                    <i class="fas fa-rocket"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">高性能设计</h3>
                <p class="text-gray-600">异步处理、多级缓存和优化的网络请求，提升整体性能。</p>
            </div>
        </div>
    </div>
</section>

<!-- 页脚 -->
<footer class="bg-gray-800 text-white py-8">
    <div class="container mx-auto px-6">
        <div class="flex flex-col md:flex-row justify-between items-center">
            <div class="mb-4 md:mb-0">
                <span class="text-xl font-bold">TransBridge</span>
                <span class="ml-2 text-gray-400">多模型翻译网关</span>
            </div>
            <div class="flex space-x-4">
                <a href="https://github.com/fruitbars/transbridge" class="text-gray-400 hover:text-white" target="_blank">
                    <i class="fab fa-github text-xl"></i>
                </a>
                <a href="https://github.com/fruitbars/transbridge#readme" class="text-gray-400 hover:text-white" target="_blank">文档</a>
                <a href="https://freeapi.fanyimao.cn/" class="text-gray-400 hover:text-white" target="_blank">API</a>
            </div>
        </div>
        <div class="mt-4 text-center text-gray-400 text-sm">
            <p>&copy; 2025 TransBridge. MIT 许可证开源。</p>
        </div>
    </div>
</footer>

<!-- 脚本 -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 获取DOM元素
        const translateBtn = document.getElementById('translate-btn');
        const sourceText = document.getElementById('source-text');
        const sourceLang = document.getElementById('source-lang');
        const targetLang = document.getElementById('target-lang');
        const translatedText = document.getElementById('translated-text');
        const errorContainer = document.getElementById('error-container');
        const errorMessage = document.getElementById('error-message');
        const loading = document.getElementById('loading');
        const sourceCount = document.getElementById('source-count');
        const swapLangBtn = document.getElementById('swap-lang-btn');
        const clearSourceBtn = document.getElementById('clear-source-btn');
        const speakSourceBtn = document.getElementById('speak-source-btn');
        const speakTranslatedBtn = document.getElementById('speak-translated-btn');
        const copySourceBtn = document.getElementById('copy-source-btn');
        const copyTranslatedBtn = document.getElementById('copy-translated-btn');
        const statusMessage = document.getElementById('status-message');

        // API URL
        const API_URL = 'https://freeapi.fanyimao.cn/v2/translate';

        // 更新字符计数
        function updateCharCount() {
            const count = sourceText.value.length;
            sourceCount.textContent = `${count}/5000`;

            // 如果超过限制，改变颜色
            if (count > 5000) {
                sourceCount.classList.add('text-red-600');
            } else {
                sourceCount.classList.remove('text-red-600');
            }
        }

        // 输入时更新字符计数
        sourceText.addEventListener('input', updateCharCount);

        // 自动翻译（当用户停止输入一段时间后）
        let typingTimer;
        const doneTypingInterval = 1000; // 1秒

        sourceText.addEventListener('keyup', function() {
            clearTimeout(typingTimer);
            if (sourceText.value) {
                typingTimer = setTimeout(autoTranslate, doneTypingInterval);
            }
        });

        sourceText.addEventListener('keydown', function() {
            clearTimeout(typingTimer);
        });

        // 自动翻译函数
        function autoTranslate() {
            // 如果文本不为空，且有不同于上一次的值
            if (sourceText.value.trim() && sourceText.dataset.lastTranslated !== sourceText.value) {
                // 设置状态消息而不是显示加载动画
                statusMessage.textContent = "正在自动翻译...";
                translate(true); // 传入true表示这是自动翻译
            }
        }

        // 翻译函数
        async function translate(isAuto = false) {
            const text = sourceText.value.trim();
            if (!text) {
                showError('请输入要翻译的文本');
                return;
            }

            // 存储当前文本，用于自动翻译比较
            sourceText.dataset.lastTranslated = text;

            // 如果不是自动翻译，显示加载动画
            if (!isAuto) {
                loading.classList.remove('hidden');
                statusMessage.textContent = "";
            }

            errorContainer.classList.add('hidden');

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer tr-98584e33-f387-42cc-a467-f02513bd400d'
                    },
                    body: JSON.stringify({
                        text: text,
                        source_lang: sourceLang.value,
                        target_lang: targetLang.value
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error ${response.status}`);
                }

                const data = await response.json();

                if (data.code === 200) {
                    translatedText.textContent = data.data;
                    // 翻译完成后更新状态
                    statusMessage.textContent = "翻译完成";
                    setTimeout(() => {
                        statusMessage.textContent = "";
                    }, 2000);
                } else {
                    showError(`翻译失败: ${data.data}`);
                }
            } catch (error) {
                showError(`请求错误: ${error.message}`);
            } finally {
                loading.classList.add('hidden');
            }
        }

        // 点击翻译按钮
        translateBtn.addEventListener('click', function() {
            translate();
        });

        // 显示错误
        function showError(message) {
            errorMessage.textContent = message;
            errorContainer.classList.remove('hidden');
            statusMessage.textContent = "";
        }

        // 交换语言
        swapLangBtn.addEventListener('click', function() {
            const sourceVal = sourceLang.value;
            sourceLang.value = targetLang.value;
            targetLang.value = sourceVal;

            // 如果已经有译文，也交换文本
            if (translatedText.textContent) {
                const tempText = sourceText.value;
                sourceText.value = translatedText.textContent;
                translatedText.textContent = tempText;
                updateCharCount();
            }
        });

        // 清空原文
        clearSourceBtn.addEventListener('click', function() {
            sourceText.value = '';
            translatedText.textContent = '';
            updateCharCount();
        });

        // 复制原文
        copySourceBtn.addEventListener('click', function() {
            copyText(sourceText.value, copySourceBtn);
        });

        // 复制译文
        copyTranslatedBtn.addEventListener('click', function() {
            copyText(translatedText.textContent, copyTranslatedBtn);
        });

        // 通用复制函数
        function copyText(text, button) {
            navigator.clipboard.writeText(text).then(function() {
                const originalHTML = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i>';
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                }, 2000);
            }).catch(function() {
                showError('复制失败，请手动复制');
            });
        }

        // 朗读文本
        speakSourceBtn.addEventListener('click', function() {
            speakText(sourceText.value, getLanguageCodeForSpeech(sourceLang.value));
        });

        speakTranslatedBtn.addEventListener('click', function() {
            speakText(translatedText.textContent, getLanguageCodeForSpeech(targetLang.value));
        });

        // 语音合成函数
        function speakText(text, lang) {
            if (!text) return;

            // 检查浏览器是否支持语音合成
            if ('speechSynthesis' in window) {
                // 停止任何正在进行的语音
                window.speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                window.speechSynthesis.speak(utterance);
            } else {
                showError('您的浏览器不支持语音合成');
            }
        }

        // 将翻译API的语言代码转换为语音合成API的语言代码
        function getLanguageCodeForSpeech(langCode) {
            const langMap = {
                'EN': 'en-US',
                'ZH': 'zh-CN',
                'JA': 'ja-JP',
                'KO': 'ko-KR',
                'FR': 'fr-FR',
                'DE': 'de-DE',
                'ES': 'es-ES',
                'IT': 'it-IT',
                'RU': 'ru-RU'
            };
            return langMap[langCode] || 'en-US';
        }

        // 初始化
        updateCharCount();
    });
</script>
</body>
</html>